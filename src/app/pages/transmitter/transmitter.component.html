<div class="tx-page">
		<form [formGroup]="form" (ngSubmit)="generate()" class="form-grid">
			<ng-container formArrayName="signals">
				<div *ngFor="let sg of signalsForm.controls; let i = index" [formGroupName]="i" class="signal-row">
					<label>
						Tipo
						<select formControlName="type">
							<option *ngFor="let type of signalTypes" [value]="type">{{ type }}</option>
						</select>
					</label>

					<label>
						Amplitude
						<input type="number" step="any" formControlName="amplitude" />
					</label>

					<label>
						f (Hz)
						<input type="number" step="any" formControlName="frequency" />
					</label>

					<label>
						Fase (rad)
						<input type="number" step="any" formControlName="phase" />
					</label>

					<button type="button" (click)="removeSignal(i)" [disabled]="signalsForm.length === 1">Remover</button>
				</div>
			</ng-container>

			<div class="row-controls">
				<button type="button" (click)="addSignal()">Adicionar sinal</button>
			</div>

			<label>
				Duração (ms)
				<input type="number" step="any" formControlName="duration" />
			</label>

			<label>
				Freq. de Amostragem (Hz)
				<input type="number" step="any" formControlName="samplingFrequency" />
			</label>

			<div class="row-controls" style="grid-column: 1 / -1; border-top: 1px solid #e5e7eb; padding-top: .5rem; margin-top: .5rem;">
				<label style="display:flex; align-items:center; gap:.5rem;">
					<input type="checkbox" formControlName="filterEnabled" />
					Aplicar filtro passa-faixa em s(t)
				</label>
			</div>

			<div class="signal-row" *ngIf="form.get('filterEnabled')?.value">
				<label>
					f Low (Hz)
					<input type="number" step="any" formControlName="filterLow" />
				</label>
				<label>
					f High (Hz)
					<input type="number" step="any" formControlName="filterHigh" />
				</label>
				<label>
					Ordem FIR (ímpar)
					<input type="number" step="1" formControlName="filterOrder" />
				</label>
			</div>

				<label>
					Portadora fc (Hz)
					<input type="number" step="any" formControlName="carrierFrequency" />
				</label>

				<label>
					Índice m
					<input type="number" step="any" formControlName="modulationIndex" />
				</label>

				<label>
					Modulação AM
					<select formControlName="modulationMode">
						<option *ngFor="let m of modulationModes" [value]="m">{{ m }}</option>
					</select>
				</label>

			<button type="submit">Gerar</button>
		</form>

		<div style="font-size: .9rem; margin-top: .25rem;">
			<span *ngIf="fs && (fs < requiredFsForModulation)" style="color:#b91c1c;">
				Atenção: fs ({{ fs | number:'1.0-2' }}) < 2×(fc+fmax) ({{ requiredFsForModulation | number:'1.0-2' }}) — pode ocorrer aliasing na modulação.
			</span>
			<span *ngIf="form.get('filterEnabled')?.value && filterNyquistViolated" style="color:#b91c1c; display:block;">
				Atenção: fHigh ({{ filterHigh | number:'1.0-2' }}) ≥ fs/2 ({{ (fs/2) | number:'1.0-2' }}) — ajuste a banda do filtro.
			</span>
			<div *ngIf="fs && form.get('duration')?.value">Amostras previstas: <b>{{ expectedSamples }}</b></div>
		</div>

		<div class="chart-wrap">
			<app-signal-chart [data]="baseband" title="Banda-base m(t)"></app-signal-chart>
		</div>

		<div class="chart-wrap" *ngIf="filtered">
			<app-signal-chart [data]="filtered" title="Banda-base Filtrada (Passa-Faixa)"></app-signal-chart>
		</div>

		<div class="chart-wrap" *ngIf="filterEnabled && freqResponse">
			<app-signal-chart [data]="freqResponse" [type]="'frequency-response'" title="Resposta em Frequência do Filtro (|H(f)|)"></app-signal-chart>
		</div>

		<div class="chart-wrap">
			<app-signal-chart [data]="output" title="Sinal Modulado"></app-signal-chart>
		</div>
</div>
